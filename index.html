<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UEFA Draw — Standalone</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    html, body { height: 100%; }
    :root{
      --txt:#ffffff;
      /* bars */
      --uclBar1:#0232FF; --uclBar2:#00eeff;
      --uelBar1:#000000; --uelBar2:#ff5f00;
      /* HA tags + highlight + glow (UCL default) */
      --haH:#1e4bff; --haA:#00b2ff; /* H / A backgrounds */
      --hiEdge: rgba(0,238,255,.45); --hiOuter: rgba(0,238,255,.30); --hiInner: rgba(2,50,255,.22);
      --glow1: rgba(0,238,255,.55); --glow2: rgba(0,238,255,.35);
      /* suggest menu */
      --suggBg: rgba(4,17,42,.96); --suggBorder: rgba(255,255,255,.12);
    }
    body.theme-uel{
      /* UEL palette overrides */
      --haH:#ff5f00; --haA:#111111;
      --hiEdge: rgba(255,95,0,.65); --hiOuter: rgba(255,95,0,.36); --hiInner: rgba(255,95,0,.22);
      --glow1: rgba(255,95,0,.7); --glow2: rgba(255,95,0,.45);
      --suggBg: rgba(0,0,0,.92); --suggBorder: rgba(255,95,0,.45);
    }
    *{box-sizing:border-box}
    body{margin:0; color:var(--txt); background: url('assets/arkaplanucl.jpg') no-repeat center center fixed; background-size: cover; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;}
    body.theme-uel{ background: url('crests/background_europaijpg') no-repeat center center fixed; background-size: cover; }
    .wrap{max-width:1120px; margin:0 auto; padding:16px}
    .h-display{font-family:'Barlow Condensed', Inter, sans-serif; letter-spacing:.02em; color:#fff}
    .tile{background:rgba(8,21,48,.38); border:1px solid rgba(255,255,255,.12); border-radius:14px; backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px)}
    .tile.highlight{ border-color: var(--hiEdge); box-shadow: 0 0 0 2px var(--hiEdge), 0 0 32px var(--hiOuter), inset 0 0 24px var(--hiInner); animation: glow 2.4s ease-in-out infinite alternate }
    @keyframes glow{ from{ box-shadow: 0 0 0 2px var(--hiEdge), 0 0 18px var(--hiOuter), inset 0 0 12px var(--hiInner)} to{ box-shadow: 0 0 0 2px var(--hiEdge), 0 0 36px var(--hiOuter), inset 0 0 24px var(--hiInner)} }
    .bar{ color:#fff; border-radius:10px; font-weight:800 }
    .bar.ucl{ background:linear-gradient(90deg, var(--uclBar1), var(--uclBar2)); }
    .bar.uel{ background:linear-gradient(90deg, var(--uelBar1), var(--uelBar2)); }
    /* Start button theming */
    #startBtn{border-radius:9999px; padding:.85rem 1.4rem; font-weight:800; font-family:'Barlow Condensed', Inter; letter-spacing:.02em; border:none; background:linear-gradient(90deg,#0232FF,#7a3cff); color:#fff; box-shadow:0 10px 24px rgba(0,0,0,.35); cursor:pointer; transition:transform .08s ease, box-shadow .2s ease}
    body.theme-uel #startBtn{ background:linear-gradient(90deg, #000000, #ff5f00) }
    #startBtn:hover{box-shadow:0 12px 28px rgba(0,0,0,.45)} #startBtn:active{transform:translateY(1px) scale(.98)} #startBtn:focus-visible{outline:3px solid rgba(255,255,255,.6); outline-offset:2px}
    /* Pulsing glow uses variables so palette switches with theme */
    .btn-glow{ animation: btnpulse 1.3s ease-in-out infinite; box-shadow:0 0 0 0 var(--glow1), 0 0 22px var(--glow2) }
    @keyframes btnpulse{ 0%{ box-shadow:0 0 0 0 var(--glow1), 0 0 22px var(--glow2)} 100%{ box-shadow:0 0 0 12px rgba(0,0,0,0), 0 0 10px var(--glow2)} }

    .chooser{max-width:760px; margin:0 auto}
    .input{width:100%; padding:.8rem 1rem; border-radius:12px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.18); color:#fff}
    .input::placeholder{ color: rgba(255,255,255,.55) }
    .suggest{position:absolute; z-index:20; width:100%; background:var(--suggBg); border:1px solid var(--suggBorder); border-radius:12px; overflow:hidden; max-height:320px; overflow-y:auto}
    .suggest li{padding:.55rem .8rem; cursor:pointer; display:flex; align-items:center; gap:8px}
    .suggest li:hover{background:rgba(255,255,255,.06)}
    .row{display:flex; gap:8px; align-items:center}
    .center{display:flex; flex-direction:column; align-items:center}
    .mb2{margin-bottom:8px} .mb4{margin-bottom:16px}
    .tag{font-size:11px; padding:.1rem .35rem; border-radius:6px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12)}
    .haTag{width:24px; height:18px; border-radius:4px; display:grid; place-items:center; font-weight:800; font-size:12px; color:#fff}
    .h{background:var(--haH)} .a{background:var(--haA)}
    .grid{display:grid; gap:16px}
    @media(min-width:640px){ .grid.cols-2{grid-template-columns:1fr 1fr} }
    @media(min-width:1024px){ .grid.cols-3{grid-template-columns:1fr 1fr 1fr} }
    .crest{width:18px; height:18px; border-radius:4px; object-fit:contain; background:transparent}
    .error{color:#ffd0d0; background:rgba(255,0,0,.1); border:1px solid rgba(255,0,0,.25); padding:8px 12px; border-radius:12px; text-align:center}
    .reveal{animation: pop .28s cubic-bezier(.2,1,.2,1)}
    @keyframes pop{ from{ transform: scale(.96); opacity:.4 } to{ transform: scale(1); opacity:1 } }
    .pin{max-width:44rem; margin: 0 auto 12px auto}

    /* masthead + segment control */
    .mast{display:flex; justify-content:center; align-items:center; margin-bottom:8px}
    .mast img{width:90px; height:90px; opacity:.9; filter: drop-shadow(0 0 10px rgba(255,255,255,.25))}
    .seg{display:flex; align-items:center; gap:4px; padding:4px; border-radius:9999px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18); backdrop-filter: blur(6px)}
    .seg-btn{display:flex; align-items:center; gap:8px; padding:.5rem .9rem; border-radius:9999px; background:transparent; border:none; color:#fff; font-weight:800; font-family:'Barlow Condensed', Inter; letter-spacing:.02em; cursor:pointer}
    .seg-btn img{width:18px; height:18px}
    .seg-btn.active{background:linear-gradient(90deg, var(--uclBar1), var(--uclBar2)); box-shadow:0 6px 16px rgba(0,0,0,.25)}
    body.theme-uel .seg-btn.active{background:linear-gradient(90deg, var(--uelBar1), var(--uelBar2))}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- masthead star centered above search -->
    <div class="mast"><img id="mastStar" src="assets/ucl_logo.png" alt="starball"/></div>

    <!-- selector modern segmented control -->
    <div class="center mb4">
      <div class="seg" id="segToggle">
        <button id="btnUCL" class="seg-btn active"><img src="assets/ucl_logo.png" alt=""/>Champions League</button>
        <button id="btnUEL" class="seg-btn"><img src="crests/europaleague.png" alt=""/>Europa League</button>
      </div>
    </div>

    <!-- chooser -->
    <div class="center mb4">
      <div class="chooser" style="position:relative; width:100%">
        <label class="mb2" style="display:block; font-size:12px; opacity:.9">Your Team</label>
        <input id="teamInput" class="input" placeholder="Type to search" />
        <ul id="suggestList" class="suggest" style="display:none; margin-top:8px"></ul>
      </div>
      <button id="startBtn" class="btn-glow" style="margin-top:12px">Start</button>
    </div>

    <div id="errorBox" class="error" style="display:none"></div>

    <div id="focusMount"></div>
    <div id="allMount"></div>
  </div>

<script>
// ---------------- DATA ----------------
const UCL_TEAMS = [
  { name:'Paris Saint-Germain', country:'FRA', pot:1 },{ name:'Real Madrid', country:'ESP', pot:1 },{ name:'Manchester City', country:'ENG', pot:1 },{ name:'Bayern München', country:'GER', pot:1 },{ name:'Liverpool', country:'ENG', pot:1 },{ name:'Inter', country:'ITA', pot:1 },{ name:'Chelsea', country:'ENG', pot:1 },{ name:'Borussia Dortmund', country:'GER', pot:1 },{ name:'Barcelona', country:'ESP', pot:1 },
  { name:'Arsenal', country:'ENG', pot:2 },{ name:'Bayer Leverkusen', country:'GER', pot:2 },{ name:'Atlético Madrid', country:'ESP', pot:2 },{ name:'Benfica', country:'POR', pot:2 },{ name:'Atalanta', country:'ITA', pot:2 },{ name:'Villarreal', country:'ESP', pot:2 },{ name:'Juventus', country:'ITA', pot:2 },{ name:'Eintracht Frankfurt', country:'GER', pot:2 },{ name:'Club Brugge', country:'BEL', pot:2 },
  { name:'Tottenham Hotspur', country:'ENG', pot:3 },{ name:'PSV Eindhoven', country:'NED', pot:3 },{ name:'Ajax', country:'NED', pot:3 },{ name:'Napoli', country:'ITA', pot:3 },{ name:'Sporting CP', country:'POR', pot:3 },{ name:'Olympiacos', country:'GRE', pot:3 },{ name:'Slavia Praha', country:'CZE', pot:3 },{ name:'Bodø/Glimt', country:'NOR', pot:3 },{ name:'Marseille', country:'FRA', pot:3 },
  { name:'Copenhagen', country:'DEN', pot:4 },{ name:'Monaco', country:'FRA', pot:4 },{ name:'Galatasaray', country:'TUR', pot:4 },{ name:'Union SG', country:'BEL', pot:4 },{ name:'Qarabağ', country:'AZE', pot:4 },{ name:'Athletic Club', country:'ESP', pot:4 },{ name:'Newcastle United', country:'ENG', pot:4 },{ name:'Pafos', country:'CYP', pot:4 },{ name:'Kairat Almaty', country:'KAZ', pot:4 }
];

const UEL_TEAMS = [
  { name:'Basel', country:'SUI', pot:1 }, { name:'Real Betis', country:'ESP', pot:1 }, { name:'Bologna', country:'ITA', pot:1 }, { name:'Braga', country:'POR', pot:1 }, { name:'Brann', country:'NOR', pot:1 }, { name:'Celta Vigo', country:'ESP', pot:1 }, { name:'Celtic', country:'SCO', pot:1 }, { name:'Dinamo Zagreb', country:'CRO', pot:1 }, { name:'Eintracht Frankfurt', country:'GER', pot:1 },
  { name:'Feyenoord', country:'NED', pot:2 }, { name:'Fenerbahçe', country:'TUR', pot:2 }, { name:'Sporting Braga', country:'POR', pot:2 }, { name:'Lille', country:'FRA', pot:2 }, { name:'Lyon', country:'FRA', pot:2 }, { name:'Maccabi Tel-Aviv', country:'ISR', pot:2 }, { name:'Midtjylland', country:'DEN', pot:2 }, { name:'Nice', country:'FRA', pot:2 }, { name:'PAOK', country:'GRE', pot:2 },
  { name:'Porto', country:'POR', pot:3 }, { name:'Rangers', country:'SCO', pot:3 }, { name:'Roma', country:'ITA', pot:3 }, { name:'Red Bull Salzburg', country:'AUT', pot:3 }, { name:'Sturm Graz', country:'AUT', pot:3 }, { name:'Stuttgart', country:'GER', pot:3 }, { name:'Union Berlin', country:'GER', pot:3 }, { name:'Utrecht', country:'NED', pot:3 }, { name:'Young Boys', country:'SUI', pot:3 },
  { name:'Anderlecht', country:'BEL', pot:4 }, { name:'FCSB', country:'ROU', pot:4 }, { name:'Ferencváros', country:'HUN', pot:4 }, { name:'Genk', country:'BEL', pot:4 }, { name:'Hapoel Tel Aviv', country:'ISR', pot:4 }, { name:'Kızılyıldız', country:'SRB', pot:4 }, { name:'Ludogorets', country:'BUL', pot:4 }, { name:'Malmö', country:'SWE', pot:4 }, { name:'Viktoria Plzeň', country:'CZE', pot:4 }
];

// Crest map (short; extend as needed)
const CREST_BASE='crests';
const CREST_MAP={ 'Paris Saint-Germain':'psg','Real Madrid':'real','Manchester City':'city','Bayern München':'bayern','Liverpool':'lfc','Inter':'inter','Chelsea':'cfc','Borussia Dortmund':'bvb','Barcelona':'barcelona','Arsenal':'arsenal','Bayer Leverkusen':'bayer','Atlético Madrid':'atleti','Benfica':'benfica','Atalanta':'atalanta','Villarreal':'villareal','Juventus':'juve','Eintracht Frankfurt':'frankfurt','Club Brugge':'brugge','Tottenham Hotspur':'spurs','PSV Eindhoven':'psv','Ajax':'ajax','Napoli':'napoli','Sporting CP':'sporting','Olympiacos':'olympiacos','Slavia Praha':'slavia','Bodø/Glimt':'bodo','Marseille':'marseille','Copenhagen':'copenhagen','Monaco':'monaco','Galatasaray':'gs','Union SG':'union','Qarabağ':'qarabag','Athletic Club':'athletic','Newcastle United':'newcastle','Pafos':'pafos','Kairat Almaty':'kairat',
  'Basel':'basel','Real Betis':'betis','Bologna':'bologna','Braga':'braga','Brann':'brann','Celta Vigo':'celta','Celtic':'celtic','Dinamo Zagreb':'dinamo','Feyenoord':'feyenoord','Fenerbahçe':'fener','Sporting Braga':'braga','Lille':'lille','Lyon':'lyon','Maccabi Tel-Aviv':'telaviv','Midtjylland':'midt','Nice':'nice','PAOK':'paok','Porto':'porto','Rangers':'rangers','Roma':'roma','Red Bull Salzburg':'salzburg','Sturm Graz':'strumgraz','Stuttgart':'stuttgart','Union Berlin':'union','Utrecht':'utrecht','Young Boys':'youngboys','Anderlecht':'anderlecht','FCSB':'fcsb','Ferencváros':'feren','Genk':'genk','Hapoel Tel Aviv':'telaviv','Kızılyıldız':'kizilyildiz','Ludogorets':'ludogrets','Malmö':'malmo','Viktoria Plzeň':'plezen','europaleague':'europaleague'};
function crestUrl(name){ const slug=CREST_MAP[name]; return slug? `${CREST_BASE}/${slug}.png` : `${CREST_BASE}/missing.png`; }

// ---------------- CORE UTILS ----------------
const norm=(s='')=> s.normalize('NFD').replace(/[̀-ͯ]/g,'').toLowerCase();
const byPot=(teams)=>{ const p=[[],[],[],[]]; teams.forEach(t=>p[t.pot-1].push(t)); return p; };
function orderFixturesInterleaved(list){ const pots={1:[],2:[],3:[],4:[]}; for(const f of list) pots[f.pot].push(f); for(let p=1;p<=4;p++) pots[p].sort((A,B)=>A.opponent.localeCompare(B.opponent)); const out=[]; for(let r=0;r<2;r++){ for(let p=1;p<=4;p++){ if(pots[p][r]) out.push(pots[p][r]); } } return out; }

// pairing builder (Swiss-like)
function buildPairings(teams, tries=300){
  const allPots=[1,2,3,4]; const idxByPot=byPot(teams); const countryFreq={}; teams.forEach(t=> countryFreq[t.country]=(countryFreq[t.country]||0)+1);
  function attempt(){
    const need=new Map(), assoc=new Map(), opp=new Map(), byName=new Map();
    teams.forEach(t=>{ need.set(t.name,{1:2,2:2,3:2,4:2}); assoc.set(t.name,{}); opp.set(t.name,new Set()); byName.set(t.name,t); });
    const tasks=[]; for(const t of teams){ for(const p of allPots){ tasks.push([t,p]); tasks.push([t,p]); } }
    function canPair(a,b,p){ return a.name!==b.name && a.country!==b.country && !opp.get(a.name).has(b.name) && (assoc.get(a.name)[b.country]||0)<2 && (assoc.get(b.name)[a.country]||0)<2 && (need.get(a.name)[p]>0) && (need.get(b.name)[a.pot]>0); }
    function candidatesFor(t,p){ const list=idxByPot[p-1]; const out=[]; for(const c of list){ if(canPair(t,c,p)) out.push(c); } out.sort((A,B)=>{ const aN=(need.get(A.name)[t.pot]); const bN=(need.get(B.name)[t.pot]); if(aN!==bN) return aN-bN; const aA=(assoc.get(A.name)[t.country]||0); const bA=(assoc.get(B.name)[t.country]||0); if(aA!==bA) return aA-bA; const ar=countryFreq[A.country], br=countryFreq[B.country]; if(ar!==br) return ar-br; return Math.random()<.5?-1:1; }); return out; }
    function place(a,b){ opp.get(a.name).add(b.name); opp.get(b.name).add(a.name); need.get(a.name)[b.pot]--; need.get(b.name)[a.pot]--; assoc.get(a.name)[b.country]=(assoc.get(a.name)[b.country]||0)+1; assoc.get(b.name)[a.country]=(assoc.get(b.name)[a.country]||0)+1; }
    for(let step=0; step<tasks.length; step++){ let bestIdx=-1, bestCnt=1e9, bestC=null; for(let i=0;i<tasks.length;i++){ const it=tasks[i]; if(!it) continue; const [t,p]=it; if(need.get(t.name)[p]<=0){ tasks[i]=null; continue; } const c=candidatesFor(t,p); const cnt=c.length; if(cnt===0) return null; if(cnt<bestCnt){ bestCnt=cnt; bestIdx=i; bestC=c; if(cnt===1) break; } } if(bestIdx<0) break; const [t,p]=tasks[bestIdx]; const pick=bestC[Math.floor(Math.random()*Math.min(bestC.length,3))]; place(t,pick); tasks[bestIdx]=null; }
    const table=teams.map(t=>{ const res={team:t,pots:{1:[],2:[],3:[],4:[]}}; for(const oname of opp.get(t.name)){ res.pots[ byName.get(oname).pot ].push(oname); } for(const q of allPots){ if(res.pots[q].length!==2) return null; } return res; }); if(table.some(x=>!x)) return null;
    const edgeHA=new Map();
    const withHA=table.map(row=>{ const list=[]; const t=row.team.name; for(const p of allPots){ const pair=row.pots[p]; const [o1,o2]=pair; const k1=[t,o1].sort().join('#'), k2=[t,o2].sort().join('#'); const firstHome= edgeHA.get(k1) ?? (Math.random()<.5); edgeHA.set(k1, firstHome); edgeHA.set(k2, !firstHome); list.push({opponent:o1, pot:p, home: edgeHA.get(k1) }); list.push({opponent:o2, pot:p, home: edgeHA.get(k2) }); } return { team: row.team, fixtures: orderFixturesInterleaved(list) }; });
    return { ok:true, table:withHA };
  }
  for(let k=0;k<tries;k++){ const r=attempt(); if(r) return r; } return { ok:false, error:'Pairing failed.' };
}

// ---------------- STATE & UI ----------------
let selected=''; let res=null; let phase='idle'; let revealed=[]; let revealToken=0; let TEAM_POOL=UCL_TEAMS; let BAR_CLASS='ucl';

const input=document.querySelector('#teamInput'); const listEl=document.querySelector('#suggestList');
const focusMount=document.querySelector('#focusMount'); const allMount=document.querySelector('#allMount'); const errorBox=document.querySelector('#errorBox');
const mastStar = document.getElementById('mastStar');

function currentSuggestions(){ const q=norm(input.value); if(!q) return TEAM_POOL; return TEAM_POOL.filter(t=> norm(t.name).startsWith(q)); }
function openSuggest(){ fillSuggest(currentSuggestions()); listEl.style.display='block'; }
function closeSuggest(){ listEl.style.display='none'; }
function fillSuggest(items){ listEl.innerHTML=''; items.slice(0,36).forEach(t=>{ const li=document.createElement('li'); const img=document.createElement('img'); img.className='crest'; img.src=crestUrl(t.name); img.alt=''; img.onerror=()=>{ img.src=CREST_BASE+'/missing.png'; }; const text=document.createElement('span'); text.textContent=`${t.name} (${t.country})`; li.append(img, text); li.onmousedown=(e)=>{ e.preventDefault(); pickTeam(t.name); closeSuggest(); }; listEl.appendChild(li); }); }
function pickTeam(name){ selected=name; input.value=name; if(res){ if(phase==='focus'){ runFocusReveal(name, res.table);} else { phase='all'; renderAll(); } } }

// inputs
input.addEventListener('focus', ()=> openSuggest());
input.addEventListener('blur', ()=> setTimeout(closeSuggest, 60));
input.addEventListener('input', ()=>{ fillSuggest(currentSuggestions()); listEl.style.display='block'; });
input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); const q=norm(input.value); const exact=TEAM_POOL.find(t=> norm(t.name)===q); if(exact) pickTeam(exact.name); else { const sug=currentSuggestions(); if(sug.length>0) pickTeam(sug[0].name); } closeSuggest(); } if(e.key==='Escape'){ closeSuggest(); } });

function showError(msg){ errorBox.textContent=msg; errorBox.style.display='block'; } function clearError(){ errorBox.style.display='none'; errorBox.textContent=''; }

function pinTeam(name){ selected=name; if(res){ phase='all'; renderAll(); window.scrollTo({top:0, behavior:'smooth'}); } }

function teamPanel(row, highlight=false){ const ordered=row.fixtures; const box=document.createElement('div'); box.className='tile p-3'; box.style.padding='12px'; if(highlight) box.classList.add('highlight'); const list=document.createElement('ul'); list.style.listStyle='none'; list.style.padding=0; list.style.margin='0 0 12px 0'; ordered.forEach(f=>{ const li=document.createElement('li'); li.className='row'; li.style.justifyContent='space-between'; li.style.padding='6px 8px'; li.style.border='1px solid rgba(255,255,255,.1)'; li.style.borderRadius='10px'; li.style.margin='4px 0'; const left=document.createElement('div'); left.className='row'; left.style.minWidth='0'; const img=document.createElement('img'); img.className='crest'; img.loading='lazy'; img.src=crestUrl(f.opponent); img.alt=f.opponent; img.onerror=()=>{ img.src=CREST_BASE+'/missing.png'; }; const nameSpan=document.createElement('span'); nameSpan.textContent=f.opponent; nameSpan.style.whiteSpace='nowrap'; nameSpan.style.overflow='hidden'; nameSpan.style.textOverflow='ellipsis'; nameSpan.style.cursor='pointer'; nameSpan.title='Pin this team'; nameSpan.addEventListener('click', ()=> pinTeam(f.opponent)); const tag=document.createElement('span'); tag.className='tag'; tag.textContent='Pot '+f.pot; tag.style.marginLeft='8px'; left.append(img, nameSpan, tag); const ha=document.createElement('div'); ha.className='haTag '+(f.home?'h':'a'); ha.textContent=f.home?'H':'A'; li.append(left, ha); list.appendChild(li); }); const bar=document.createElement('div'); bar.className='bar '+BAR_CLASS+' row'; bar.style.padding='10px 12px'; bar.style.gap='8px'; bar.style.alignItems='center'; const timg=document.createElement('img'); timg.className='crest'; timg.src=crestUrl(row.team.name); timg.alt=row.team.name; timg.onerror=()=>{ timg.src=CREST_BASE+'/missing.png'; }; const tname=document.createElement('button'); tname.className='h-display'; tname.style.fontSize='18px'; tname.style.overflow='hidden'; tname.style.textOverflow='ellipsis'; tname.style.background='transparent'; tname.style.border='none'; tname.style.color='#fff'; tname.style.cursor='pointer'; tname.textContent=row.team.name; tname.title='Pin this team'; tname.addEventListener('click', ()=> pinTeam(row.team.name)); bar.append(timg,tname); box.append(list,bar); return box; }

function focusPanel(row, revealedNames){ const items=row.fixtures.filter(f=> revealedNames.includes(f.opponent)); const box=document.createElement('div'); box.className='center'; const tile=document.createElement('div'); tile.className='tile highlight'; tile.style.padding='12px'; tile.style.maxWidth='720px'; tile.style.width='100%'; const ul=document.createElement('ul'); ul.style.listStyle='none'; ul.style.padding=0; ul.style.margin='0 0 12px 0'; items.forEach(f=>{ const li=document.createElement('li'); li.className='row reveal'; li.style.justifyContent='space-between'; li.style.padding='6px 8px'; li.style.border='1px solid rgba(255,255,255,.1)'; li.style.borderRadius='10px'; li.style.margin='4px 0'; const left=document.createElement('div'); left.className='row'; left.style.minWidth='0'; const img=document.createElement('img'); img.className='crest'; img.src=crestUrl(f.opponent); img.alt=f.opponent; img.onerror=()=>{ img.src=CREST_BASE+'/missing.png'; }; const span=document.createElement('button'); span.textContent=f.opponent; span.style.whiteSpace='nowrap'; span.style.overflow='hidden'; span.style.textOverflow='ellipsis'; span.style.background='transparent'; span.style.border='none'; span.style.color='#fff'; span.style.cursor='pointer'; span.title='Pin this team'; span.addEventListener('click', ()=> pinTeam(f.opponent)); const tag=document.createElement('span'); tag.className='tag'; tag.textContent='Pot '+f.pot; tag.style.marginLeft='8px'; const ha=document.createElement('div'); ha.className='haTag '+(f.home?'h':'a'); ha.textContent=f.home?'H':'A'; left.append(img, span, tag); li.append(left, ha); ul.appendChild(li); }); const bar=document.createElement('div'); bar.className='bar '+BAR_CLASS+' row'; bar.style.padding='10px 12px'; bar.style.gap='8px'; bar.style.alignItems='center'; const timg=document.createElement('img'); timg.className='crest'; timg.src=crestUrl(row.team.name); timg.alt=row.team.name; timg.onerror=()=>{ timg.src=CREST_BASE+'/missing.png'; }; const tname=document.createElement('div'); tname.className='h-display'; tname.style.fontSize='18px'; tname.textContent=row.team.name; bar.append(timg, tname); tile.append(ul, bar); box.appendChild(tile); return box; }

function renderFocus(row){ focusMount.innerHTML=''; allMount.innerHTML=''; focusMount.appendChild(focusPanel(row, revealed)); }
function renderAll(){ focusMount.innerHTML=''; allMount.innerHTML=''; if(!res) return; const pinned=res.table.find(r=> r.team.name===selected) || res.table[0]; if(!pinned) return; const others=res.table.filter(r=> r!==pinned); const pinWrap=document.createElement('div'); pinWrap.className='pin'; pinWrap.appendChild(teamPanel(pinned, true)); allMount.appendChild(pinWrap); const grid=document.createElement('div'); grid.className='grid cols-1 cols-2 cols-3'; allMount.appendChild(grid); others.forEach(row=> grid.appendChild(teamPanel(row,false))); }

function runFocusReveal(name, tableSrc){ if(!tableSrc) return; const focusRow=tableSrc.find(r=> r.team.name===name); if(!focusRow){ showError('Selected team not found.'); return; } phase='focus'; revealed=[]; revealToken++; const token=revealToken; clearError(); renderFocus(focusRow); focusRow.fixtures.forEach((f,idx)=>{ setTimeout(()=>{ if(revealToken!==token) return; revealed.push(f.opponent); renderFocus(focusRow); if(revealed.length>=8){ phase='all'; renderAll(); } }, 650*(idx+1)); }); }

const startBtn=document.querySelector('#startBtn');
startBtn.addEventListener('click', ()=>{ if(startBtn.classList.contains('btn-glow')) startBtn.classList.remove('btn-glow'); clearError(); const chosen=selected || (currentSuggestions()[0]?.name || ''); if(!chosen){ showError('Pick a team first.'); return; } const out=buildPairings(TEAM_POOL, 600); if(!out || !out.ok){ showError(out?.error || 'Pairing failed.'); return; } res=out; runFocusReveal(chosen, out.table); });

// selector
const btnUCL=document.querySelector('#btnUCL');
const btnUEL=document.querySelector('#btnUEL');
function activate(seg){ if(seg==='ucl'){ document.body.classList.remove('theme-uel'); TEAM_POOL=UCL_TEAMS; BAR_CLASS='ucl'; btnUCL.classList.add('active'); btnUEL.classList.remove('active'); mastStar.src='assets/ucl_logo.png'; } else { document.body.classList.add('theme-uel'); TEAM_POOL=UEL_TEAMS; BAR_CLASS='uel'; btnUEL.classList.add('active'); btnUCL.classList.remove('active'); mastStar.src='crests/europaleague.png'; } selected=''; input.value=''; res=null; revealToken++; focusMount.innerHTML=''; allMount.innerHTML=''; fillSuggest(currentSuggestions()); listEl.style.display='block'; startBtn.classList.add('btn-glow'); }
btnUCL.addEventListener('click', ()=> activate('ucl'));
btnUEL.addEventListener('click', ()=> activate('uel'));
</script>
</body>
</html>
